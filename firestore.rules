rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Allow public read access (get and list) to apartment listings
    match /apartments/{apartmentId} {
      allow get, list: if true;
      // Allow writes only for authenticated users who are admins.
      // This is a placeholder for real admin role-based security.
      allow write: if request.auth != null; 
    }
    
    // Rules for the 'users' collection
    match /users/{userId} {
      // A user can only be created if the requesting user's ID matches the document ID.
      // This prevents users from creating documents for others.
      allow create: if request.auth != null && request.auth.uid == userId;

      // A user can only read their own document.
      allow get: if request.auth != null && request.auth.uid == userId;

      // Allow users to update their own document (e.g., display name, photo URL)
      allow update: if request.auth != null && request.auth.uid == userId;
      
      // Users cannot delete their own user document.
      allow delete: if false;

      // Rules for the 'favorites' subcollection
      match /favorites/{apartmentId} {
        // A user can read their own list of favorites.
        allow get, list: if request.auth != null && request.auth.uid == userId;

        // A user can add (create) or remove (delete) a favorite from their own list.
        allow create, delete: if request.auth != null && request.auth.uid == userId;
      }
    }
  }
}
